# Client Dashboard Components

This directory contains components for the client-facing dashboard accessed via secured links.

## Overview

The client dashboard provides a branded, personalized experience for real estate clients to access:

- Comparative Market Analysis (CMA) reports
- Property search functionality
- Home valuation tools
- Shared documents

## Components

### `client-dashboard-view.tsx`

Main dashboard view component that displays:

### `cma-report.tsx`

Comprehensive CMA (Comparative Market Analysis) report visualization component.

**Features:**

- **Price Recommendation Callout**: Displays low, mid, and high price recommendations with visual emphasis
- **Market Statistics Cards**: Shows median price, days on market, and inventory level with color-coded indicators
- **Subject Property Details**: Displays property address and key features (beds, baths, sqft, year built)
- **Property Comparison Table**: Responsive table comparing subject property with comparables
  - Address, sold price, price per sq ft
  - Beds, baths, square footage
  - Distance from subject property
  - Sold date
- **Price Trend Chart**: Interactive line chart showing historical sale prices using Recharts
  - Time-series visualization of comparable sales
  - Hover tooltips with detailed information
  - Responsive design
- **Price per Sq Ft Comparison**: Bar chart comparing value across comparable properties
- **Property Map**: Google Maps integration showing subject property and comparables
  - Subject property marked with primary color
  - Comparables marked with gray markers
  - Placeholder implementation (requires Google Maps API key)
- **Agent Notes**: Formatted text area for agent commentary and insights
- **Call to Action**: Prominent button to discuss the report with agent

**Props:**

```typescript
interface CMAReportProps {
  subjectProperty: SubjectProperty;
  comparables: ComparableProperty[];
  marketTrends: MarketTrends;
  priceRecommendation: PriceRecommendation;
  agentNotes?: string;
  primaryColor?: string;
}
```

**Requirements Satisfied:**

- **3.5**: Time-series reports generate interactive charts with zoom and filter capabilities

### `cma-report-example.tsx`

Example/demo component showcasing the CMA Report with sample data. Useful for:

- Development and testing
- Visual verification of component features
- Documentation and demos

### `client-dashboard-view.tsx` (continued)

Main dashboard view component that displays:

**Header (Sticky)**

- Agent logo (if configured)
- Agent name and contact information
- Prominent "Contact Agent" button
- Responsive design for mobile and desktop

**Main Content**

- Welcome message with agent branding
- Conditional sections based on enabled features:
  - CMA Report (if enabled and available)
  - Property Search (if enabled)
  - Home Valuation (if enabled)
  - Documents (if enabled)
- Empty states for sections without content

**Footer**

- Agent branding and contact information
- "Powered by [Agent Name]" attribution

**Features**

- Dynamic branding using agent's primary color
- Responsive design optimized for mobile viewing
- Contact modal for easy agent communication
- Conditional rendering based on dashboard configuration

## Routes

### `/d/[token]`

Short URL format for easy sharing with clients.

**Files:**

- `page.tsx` - Main dashboard page (Server Component)
- `layout.tsx` - Minimal layout without app navigation
- `loading.tsx` - Loading state during link validation
- `not-found.tsx` - Error page for invalid/expired links

## Usage

The dashboard is accessed via secured links generated by agents:

```
https://yourdomain.com/d/abc123def456
```

The link validation happens server-side in `page.tsx`:

1. Validates the token
2. Checks expiration and revocation status
3. Tracks access (view count, last accessed)
4. Returns dashboard data or shows 404

## Requirements Satisfied

- **4.1**: Property search displays agent branding
- **8.1**: Branding configuration (logo, colors, welcome message)
- **8.2**: Branding appears consistently across all sections

## Branding

The dashboard uses dynamic styling based on the agent's branding configuration:

```typescript
branding: {
  logoUrl?: string;           // Agent logo (200x200px)
  primaryColor: string;       // Hex color (e.g., "#3b82f6")
  welcomeMessage: string;     // Custom welcome text
  agentContact: {
    phone: string;
    email: string;
  };
}
```

The primary color is used for:

- Header border accent
- Welcome message section border
- Section header left border
- Contact button background
- Link hover states

## Mobile Optimization

The dashboard is fully responsive with:

- Touch-optimized buttons (min 44px height)
- Responsive header layout
- Stacked contact info on mobile
- Shortened button text on small screens
- Mobile-friendly modals and sections

## Visualization Libraries

The CMA report component uses the following libraries:

- **Recharts**: For interactive charts (line charts, bar charts)
  - Price trend visualization
  - Price per square foot comparison
  - Responsive and touch-friendly
- **@react-google-maps/api**: For property location mapping
  - Subject property marker
  - Comparable property markers
  - Interactive map with zoom and pan

## Future Enhancements

As additional features are implemented, they will be integrated into the conditional sections:

- âœ… CMA report visualization (charts, maps, comparables) - **COMPLETED**
- Property search interface with filters
- Home valuation request form
- Document list with download functionality
- Contact form with message composition
- Enhanced map integration with geocoding service
- PDF export functionality for CMA reports
