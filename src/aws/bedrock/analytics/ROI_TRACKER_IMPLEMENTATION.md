# ROI Tracker Implementation

## Overview

The ROI Tracker is a comprehensive system for tracking business outcomes and calculating return on investment (ROI) for strand-generated content. It implements Requirement 9.4 from the AgentStrands enhancement specification.

## Features

### 1. Business Outcome Tracking

Track various types of business outcomes generated by content:

- **Lead Generation**: Contact form submissions, inquiries
- **Property Views**: Listing page views, virtual tour views
- **Contact Made**: Phone calls, emails, messages
- **Appointments**: Property showings, consultations scheduled
- **Listings Signed**: New listing agreements
- **Sales Closed**: Completed property transactions
- **Referrals**: Referrals received from clients
- **Engagement**: Social media interactions, content shares
- **Brand Awareness**: Impressions, reach metrics

### 2. Content Performance Tracking

Monitor comprehensive performance metrics for each piece of content:

- **Cost Tracking**: Creation costs, distribution costs
- **Engagement Metrics**: Views, clicks, shares
- **Conversion Metrics**: Leads, appointments, sales
- **Revenue Tracking**: Direct revenue attribution
- **ROI Calculation**: Automatic ROI percentage calculation

### 3. ROI Calculation

Calculate detailed ROI metrics:

- **Investment**: Total costs (creation + distribution)
- **Return**: Total revenue generated
- **Profit**: Net profit (return - investment)
- **ROI Percentage**: (Profit / Investment) Ã— 100
- **Payback Period**: Days until investment is recovered

### 4. Performance Correlation

Correlate content performance with strand metrics:

- **Strand ROI Analysis**: Average ROI by strand type
- **Conversion Rate Analysis**: Conversion rates by strand
- **Performance Insights**: Actionable insights for optimization
- **Correlation Scores**: Quantitative performance correlation

### 5. ROI Reporting

Generate comprehensive ROI reports:

- **Overall Performance**: Total investment, return, and ROI
- **Content Type Analysis**: ROI breakdown by content type
- **Strand Analysis**: ROI breakdown by strand
- **Top/Bottom Performers**: Best and worst performing content
- **Insights**: Automated insights from data analysis
- **Recommendations**: Actionable optimization recommendations

## Architecture

### Data Model

```typescript
// Business Outcome
{
  id: string;
  contentId: string;
  strandId: string;
  userId: string;
  type: OutcomeType;
  value: number;
  description: string;
  occurredAt: string;
  metadata: Record<string, any>;
}

// Content Performance
{
  contentId: string;
  contentType: string;
  creationCost: number;
  distributionCost: number;
  totalCost: number;
  views: number;
  clicks: number;
  shares: number;
  leads: number;
  conversions: number;
  revenue: number;
  roi: number;
  createdAt: string;
  updatedAt: string;
}
```

### DynamoDB Schema

```
Business Outcomes:
PK: CONTENT#{contentId}
SK: OUTCOME#{timestamp}#{outcomeId}

Content Performance:
PK: USER#{userId}
SK: CONTENT_PERF#{contentId}
```

### Key Components

1. **ROITracker**: Main class for ROI tracking operations
2. **Business Outcome Tracking**: Records outcomes as they occur
3. **Performance Aggregation**: Aggregates outcomes into performance metrics
4. **ROI Calculation Engine**: Calculates ROI and related metrics
5. **Report Generator**: Creates comprehensive ROI reports
6. **Correlation Analyzer**: Correlates performance with strand metrics

## Usage

### Basic Usage

```typescript
import { createROITracker } from "./roi-tracker";

const roiTracker = createROITracker();

// Track a business outcome
await roiTracker.trackOutcome({
  id: "outcome-123",
  contentId: "blog-post-456",
  strandId: "content-generator",
  userId: "user-789",
  type: "lead-generated",
  value: 0,
  description: "Contact form submission",
  occurredAt: new Date().toISOString(),
  metadata: {
    contentType: "blog-post",
    creationCost: 5.5,
    distributionCost: 0,
  },
});

// Calculate ROI
const roi = await roiTracker.calculateROI("blog-post-456", "user-789");
console.log(`ROI: ${roi.roiPercentage}%`);
```

### Tracking Different Outcome Types

```typescript
// Lead generation
await roiTracker.trackOutcome({
  type: "lead-generated",
  value: 0,
  // ... other fields
});

// Sale closure
await roiTracker.trackOutcome({
  type: "sale-closed",
  value: 15000, // Commission earned
  // ... other fields
});

// Engagement
await roiTracker.trackOutcome({
  type: "engagement",
  value: 0,
  // ... other fields
});
```

### Generating Reports

```typescript
// Generate comprehensive ROI report
const report = await roiTracker.generateReport({
  userId: "user-789",
  startDate: "2024-01-01",
  endDate: "2024-12-31",
});

console.log(`Overall ROI: ${report.overallROI}%`);
console.log("Top Performers:", report.topPerformers);
console.log("Insights:", report.insights);
console.log("Recommendations:", report.recommendations);
```

### Filtering Reports

```typescript
// Filter by content type
const blogReport = await roiTracker.generateReport({
  userId: "user-789",
  contentType: "blog-post",
  minROI: 50, // Only content with >50% ROI
});

// Filter by date range
const monthlyReport = await roiTracker.generateReport({
  userId: "user-789",
  startDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),
  endDate: new Date().toISOString(),
});
```

### Performance Correlation

```typescript
// Correlate strand performance with outcomes
const correlation = await roiTracker.correlatePerformance(
  "user-789",
  "content-generator-strand",
  "30d"
);

console.log(`Correlation: ${correlation.correlation * 100}%`);
console.log("Insights:", correlation.insights);
```

## Integration Points

### 1. Content Creation

When content is created, initialize performance tracking:

```typescript
// After content creation
await roiTracker.trackOutcome({
  id: `init-${contentId}`,
  contentId,
  strandId,
  userId,
  type: "engagement",
  value: 0,
  description: "Content created",
  occurredAt: new Date().toISOString(),
  metadata: {
    contentType: "blog-post",
    creationCost: calculatedCost,
    distributionCost: 0,
  },
});
```

### 2. User Interactions

Track user interactions as outcomes:

```typescript
// When user views content
await roiTracker.trackOutcome({
  type: "property-viewed",
  value: 0,
  // ...
});

// When user clicks link
await roiTracker.trackOutcome({
  type: "engagement",
  value: 0,
  // ...
});
```

### 3. Lead Capture

Track lead generation:

```typescript
// When form is submitted
await roiTracker.trackOutcome({
  type: "lead-generated",
  value: 0,
  metadata: {
    leadSource: "contact-form",
    leadQuality: "high",
  },
  // ...
});
```

### 4. Sales Tracking

Track sales and revenue:

```typescript
// When sale closes
await roiTracker.trackOutcome({
  type: "sale-closed",
  value: commissionAmount,
  metadata: {
    propertyValue: 500000,
    commissionRate: 0.03,
  },
  // ...
});
```

### 5. Analytics Dashboard

Display ROI metrics in dashboards:

```typescript
// Get performance for dashboard
const performance = await roiTracker.getContentPerformance(contentId, userId);

// Display metrics
<MetricCard title="ROI" value={`${performance.roi}%`} />
<MetricCard title="Revenue" value={`$${performance.revenue}`} />
<MetricCard title="Conversions" value={performance.conversions} />
```

## Best Practices

### 1. Consistent Cost Tracking

Always include creation and distribution costs:

```typescript
metadata: {
  creationCost: 5.50,      // AI generation cost
  distributionCost: 25.00, // Paid promotion
}
```

### 2. Accurate Value Attribution

Attribute revenue accurately to content:

```typescript
// Direct attribution
value: 15000, // Commission from sale

// Partial attribution
value: 3000, // 20% of commission (content was one touchpoint)
```

### 3. Meaningful Metadata

Include context for better analysis:

```typescript
metadata: {
  contentType: 'blog-post',
  topic: 'market-trends',
  platform: 'website',
  source: 'organic-search',
  leadQuality: 'high',
}
```

### 4. Regular Reporting

Generate reports regularly to track trends:

```typescript
// Weekly reports
const weeklyReport = await roiTracker.generateReport({
  userId,
  startDate: sevenDaysAgo,
  endDate: now,
});

// Monthly reports
const monthlyReport = await roiTracker.generateReport({
  userId,
  startDate: thirtyDaysAgo,
  endDate: now,
});
```

### 5. Action on Insights

Use insights to optimize content strategy:

```typescript
const report = await roiTracker.generateReport({ userId });

// Identify top performers
const topContentType = Object.entries(report.byContentType).sort(
  (a, b) => b[1].roiPercentage - a[1].roiPercentage
)[0];

console.log(`Focus on ${topContentType[0]} - highest ROI`);

// Identify underperformers
const underperforming = report.bottomPerformers.filter((p) => p.roi < 0);
console.log(`Review ${underperforming.length} pieces with negative ROI`);
```

## Performance Considerations

### 1. Data Retention

Configure appropriate retention periods:

```typescript
const roiTracker = createROITracker({
  retentionDays: 365, // Keep data for 1 year
});
```

### 2. Batch Updates

For high-volume tracking, consider batching:

```typescript
// Collect outcomes
const outcomes = [];
// ... collect multiple outcomes

// Batch track
for (const outcome of outcomes) {
  await roiTracker.trackOutcome(outcome);
}
```

### 3. Caching

Cache frequently accessed performance data:

```typescript
// Cache performance metrics
const cache = new Map();

async function getCachedPerformance(contentId, userId) {
  const key = `${contentId}-${userId}`;

  if (cache.has(key)) {
    return cache.get(key);
  }

  const performance = await roiTracker.getContentPerformance(contentId, userId);
  cache.set(key, performance);

  return performance;
}
```

## Monitoring

### Key Metrics to Monitor

1. **Overall ROI**: Track platform-wide ROI trends
2. **Content Type Performance**: Monitor which content types perform best
3. **Strand Effectiveness**: Track which strands generate best ROI
4. **Conversion Rates**: Monitor lead-to-sale conversion rates
5. **Payback Periods**: Track how quickly content pays for itself

### Alerts

Set up alerts for important thresholds:

```typescript
// Alert on negative ROI
if (report.overallROI < 0) {
  sendAlert("Negative ROI detected", report);
}

// Alert on high-performing content
if (performance.roi > 500) {
  sendAlert("Exceptional content performance", performance);
}
```

## Troubleshooting

### Issue: ROI calculation returns null

**Cause**: No performance data exists for the content

**Solution**: Ensure outcomes are being tracked with proper metadata including costs

### Issue: Inaccurate ROI calculations

**Cause**: Missing or incorrect cost data

**Solution**: Always include both creation and distribution costs in metadata

### Issue: Low correlation scores

**Cause**: Insufficient data or poor content performance

**Solution**: Collect more data over time and optimize content based on insights

## Future Enhancements

1. **Predictive ROI**: Predict expected ROI before content creation
2. **Multi-touch Attribution**: Better attribution across multiple touchpoints
3. **Cohort Analysis**: Analyze ROI by user cohorts
4. **A/B Testing Integration**: Compare ROI of different content variations
5. **Real-time Dashboards**: Live ROI tracking and visualization

## Related Documentation

- [Performance Tracker](./performance-tracker.ts) - Track strand performance metrics
- [Cost Monitor](./cost-monitor.ts) - Monitor AI operation costs
- [Analytics Types](./types.ts) - Shared type definitions
- [Integration Guide](./INTEGRATION_GUIDE.md) - Integration patterns

## Support

For questions or issues with the ROI Tracker:

1. Check the examples in `roi-tracker-example.ts`
2. Review the type definitions in `types.ts`
3. Consult the main design document for requirements
4. Contact the AgentStrands team for assistance
